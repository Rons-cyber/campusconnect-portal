<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="utf-8"/>
<meta name="viewport" content="width=device-width,initial-scale=1"/>
<title>CampusConnect Portal</title>
<style>
:root{--primary:#6A0DAD;--secondary:#CBA6F7;--accent:#B266FF;--bg:#F3E8FF;--text-dark:#2E0249;--text-light:#F8F4FF;--border:#E2CFF9}
*{box-sizing:border-box;margin:0;padding:0}
body{font-family:'Segoe UI',Roboto,system-ui,-apple-system,"Helvetica Neue",Arial;background:var(--bg);color:var(--text-dark);padding-bottom:70px}
header{background:linear-gradient(135deg,var(--primary),var(--accent));color:var(--text-light);text-align:center;padding:2.5rem 1rem 2rem;border-bottom-left-radius:30px;border-bottom-right-radius:30px;position:relative;box-shadow:0 4px 12px rgba(106,13,173,.25)}
.menu-btn{position:absolute;top:15px;left:15px;background:#fff;color:var(--primary);border:none;border-radius:50%;width:38px;height:38px;font-size:1.3rem;cursor:pointer;box-shadow:0 3px 10px rgba(0,0,0,.15)}
.sidebar{height:100%;width:0;position:fixed;z-index:11;top:0;left:0;background:var(--text-light);border-right:2px solid var(--border);overflow-x:hidden;transition:.3s;padding-top:80px;box-shadow:3px 0 10px rgba(0,0,0,.1)}
.sidebar button{display:block;background:none;color:var(--primary);border:none;padding:15px 25px;text-align:left;font-size:1rem;width:100%;cursor:pointer}
.sidebar button:hover{background:linear-gradient(135deg,var(--primary),var(--accent));color:var(--text-light)}
.close-btn{position:absolute;top:20px;right:25px;background:none;border:none;font-size:1.8rem;color:var(--primary);cursor:pointer}
main{max-width:950px;margin:auto;padding:1rem}
.card{background:#fff;padding:1.3rem;border-radius:16px;margin-bottom:1.3rem;box-shadow:0 3px 10px rgba(178,102,255,.15);border:1px solid var(--border)}
input,select,textarea,button{width:100%;margin-top:6px;padding:10px;border-radius:10px;border:1.5px solid var(--border);font-size:1rem;color:var(--text-dark)}
button{background:var(--primary);color:var(--text-light);border:none;cursor:pointer;font-weight:600;margin-top:10px}
button:hover{background:var(--accent)}
.hidden{display:none}
h2{color:var(--primary);font-size:1.5rem;margin-bottom:.8rem}
.chat-box{border:1.5px solid var(--border);border-radius:10px;height:250px;overflow-y:auto;background:var(--secondary);padding:8px;margin-bottom:8px}
.list-item{border-bottom:1px solid var(--border);padding:8px 0}
.issue-btns{display:flex;gap:10px;margin-top:6px}
.resolved{background:#d1f7c4;border-left:5px solid #22c55e}
footer{position:fixed;bottom:0;left:0;width:100%;text-align:center;padding:10px 0;background:var(--text-light);border-top:2px solid var(--border);font-size:.9rem}
footer span{color:var(--accent)}footer b{color:var(--primary)}
</style>
</head>
<body>
<header>
  <button class="menu-btn" onclick="openMenu()">â˜°</button>
  <h1>CampusConnect Portal</h1>
  <p>Empowering Students, Alumni & Industry</p>
</header>

<div id="sidebar" class="sidebar">
  <button class="close-btn" onclick="closeMenu()">Ã—</button>
  <button onclick="showSection('loginSection')">Login</button>
  <button onclick="showSection('chatSection')">Chat Room</button>
  <button onclick="showSection('issueSection')">Issues</button>
  <button onclick="showSection('cgpaSection')">CGPA Calculator</button>
  <button onclick="showSection('facultySection')">Faculty</button>
  <button onclick="showSection('alumniSection')">Alumni</button>
  <button onclick="showSection('tournamentSection')">Tournaments</button>
</div>

<main>
  <!-- Login -->
  <section id="loginSection" class="card">
    <h2>Login / Register</h2>
    <input id="name" type="text" placeholder="Enter your name">
    <select id="role">
      <option value="student">Student</option>
      <option value="alumni">Alumni</option>
      <option value="faculty">Faculty</option>
      <option value="admin">Admin</option>
    </select>
    <input id="adminPass" type="password" placeholder="Enter admin password" class="hidden">
    <button onclick="login()">Continue</button>
    <button id="logoutBtn" class="hidden" onclick="logout()">Logout</button>
    <p id="welcomeMsg"></p>
  </section>

  <!-- Chat -->
  <section id="chatSection" class="card hidden">
    <h2>Chat Room</h2>
    <div id="chatBox" class="chat-box"></div>
    <input id="chatInput" placeholder="Type your message..."><button onclick="sendMessage()">Send</button>
  </section>

  <!-- Issues -->
  <section id="issueSection" class="card hidden">
    <h2>Report an Issue</h2>
    <textarea id="issueText" placeholder="Describe your issue..."></textarea>
    <button onclick="addIssue()">Submit Issue</button>
    <h3 style="margin-top:1rem;">Submitted Issues</h3>
    <div id="issueList"></div>
  </section>

  <!-- CGPA -->
  <section id="cgpaSection" class="card hidden">
    <h2>CGPA Calculator</h2>
    <div id="subjects"></div>
    <button onclick="addSubject()">+ Add Subject</button>
    <button onclick="calculateCGPA()">Calculate CGPA</button>
    <p id="cgpaResult"></p>
  </section>

  <!-- Faculty -->
  <section id="facultySection" class="card hidden">
    <h2>Faculty Directory</h2>
    <div id="facultyList"></div>
    <button id="addFacultyBtn" class="hidden" onclick="addFaculty()">+ Add Faculty</button>
  </section>

  <!-- Alumni -->
  <section id="alumniSection" class="card hidden">
    <h2>Alumni Directory</h2>
    <div id="alumniList"></div>
    <button id="addAlumniBtn" class="hidden" onclick="addAlumni()">+ Add Alumni</button>
  </section>

  <!-- Tournaments -->
  <section id="tournamentSection" class="card hidden">
    <h2>Tournaments</h2>
    <div id="tournamentList"></div>
    <button id="addTournamentBtn" class="hidden" onclick="addTournament()">+ Add Tournament</button>
  </section>
</main>

<footer>
  Â© 2025 CampusConnect | Designed with <span>ðŸ’œ</span> by <b>Aryan</b>, <b>Navdeep</b> & <b>Kritika</b>
</footer>

<script>
/* --- app state & helpers --- */
let currentRole = '';
let chatMessages = JSON.parse(localStorage.getItem('chatMessages')||'[]');
let issues = JSON.parse(localStorage.getItem('issues')||'[]');

const $ = id => document.getElementById(id);

function openMenu(){ $('sidebar').style.width = '240px'; }
function closeMenu(){ $('sidebar').style.width = '0'; }
function showSection(id){
  document.querySelectorAll('main section').forEach(s=>s.classList.add('hidden'));
  $(id).classList.remove('hidden');
  closeMenu();
}

/* show/hide admin password field when role selector changes */
$('role').addEventListener('change', ()=> $('adminPass').classList.toggle('hidden', $('role').value !== 'admin'));

/* --- requireAdmin: prompt for admin password when needed --- */
function requireAdmin(){
  // if already admin in storage, we're good
  if(localStorage.getItem('role') === 'admin'){ currentRole = 'admin'; toggleAdminButtons('admin'); $('logoutBtn').classList.remove('hidden'); return true; }
  // prompt for password
  const p = prompt('Admin password required:');
  if(p === null) return false; // user cancelled
  if(p === 'admin'){ // correct password (you can change this)
    localStorage.setItem('role','admin');
    currentRole = 'admin';
    toggleAdminButtons('admin');
    $('logoutBtn').classList.remove('hidden');
    $('welcomeMsg').innerText = $('name').value ? `Welcome ${$('name').value}! (admin)` : 'Admin';
    alert('Admin access granted');
    return true;
  } else {
    alert('Incorrect admin password');
    return false;
  }
}

/* --- load saved state --- */
window.onload = () => {
  const savedName = localStorage.getItem('name');
  const savedRole = localStorage.getItem('role');
  if(savedName){ $('name').value = savedName; $('welcomeMsg').innerText = `Welcome ${savedName}!${savedRole?(' You are logged in as '+savedRole):''}`; }
  if(savedRole){ currentRole = savedRole; $('logoutBtn').classList.remove('hidden'); toggleAdminButtons(savedRole); }
  // render persisted lists & data
  $('facultyList').innerHTML = localStorage.getItem('facultyList')||'';
  $('alumniList').innerHTML = localStorage.getItem('alumniList')||'';
  $('tournamentList').innerHTML = localStorage.getItem('tournamentList')||'';
  renderChat(); renderIssues();
};

/* --- login/logout --- */
function login(){
  const name = $('name').value.trim();
  const role = $('role').value;
  const pass = $('adminPass').value.trim();
  if(!name) return alert('Please enter your name');
  if(role==='admin' && pass !== 'admin') return alert('Incorrect admin password!');
  localStorage.setItem('name', name);
  localStorage.setItem('role', role);
  currentRole = role;
  $('welcomeMsg').innerText = `Welcome ${name}! You are logged in as ${role}.`;
  if(role === 'admin'){ toggleAdminButtons('admin'); $('logoutBtn').classList.remove('hidden'); }
  else toggleAdminButtons(''); // hide admin controls
}

function logout(){
  if(!confirm('Are you sure you want to logout?')) return;
  localStorage.removeItem('name');
  localStorage.removeItem('role');
  currentRole = '';
  $('name').value = '';
  $('welcomeMsg').innerText = '';
  $('logoutBtn').classList.add('hidden');
  toggleAdminButtons('');
  showSection('loginSection');
  alert('Logged out (site data preserved).');
}

/* --- admin controls visibility --- */
function toggleAdminButtons(role){
  ['addFacultyBtn','addAlumniBtn','addTournamentBtn'].forEach(id => {
    const el = $(id);
    if(!el) return;
    el.classList.toggle('hidden', role !== 'admin');
  });
}

/* --- chat --- */
function sendMessage(){
  const msg = $('chatInput').value.trim();
  if(!msg) return;
  const name = localStorage.getItem('name') || 'Guest';
  chatMessages.push({name,msg});
  localStorage.setItem('chatMessages', JSON.stringify(chatMessages));
  $('chatInput').value = '';
  renderChat();
}
function renderChat(){
  $('chatBox').innerHTML = chatMessages.map(c=>`<div class="chat-message"><b>${c.name}:</b> ${c.msg}</div>`).join('');
  $('chatBox').scrollTop = $('chatBox').scrollHeight;
}

/* --- issues --- */
function addIssue(){
  const text = $('issueText').value.trim();
  if(!text) return alert('Please describe your issue!');
  const name = localStorage.getItem('name') || 'Anonymous';
  const role = localStorage.getItem('role') || 'Guest';
  issues.push({name,role,text,resolved:false});
  localStorage.setItem('issues', JSON.stringify(issues));
  $('issueText').value = '';
  renderIssues();
}
function renderIssues(){
  const role = localStorage.getItem('role');
  const list = $('issueList');
  if(!issues.length){ list.innerHTML = '<p>No issues submitted yet.</p>'; return; }
  list.innerHTML = issues.map((i,idx)=>`
    <div class="list-item ${i.resolved?'resolved':''}">
      <b>${i.name}</b> <small style="color:gray">(${i.role})</small><br>${i.text}
      ${role==='admin'?`<div class="issue-btns"><button onclick="markResolved(${idx})">${i.resolved?'Unmark':'Mark Resolved'}</button><button onclick="deleteIssue(${idx})" style="background:#ff4b4b">Delete</button></div>`:''}
    </div>`).join('');
}
function markResolved(idx){
  // ensure admin
  if(localStorage.getItem('role') !== 'admin' && !requireAdmin()) return;
  issues[idx].resolved = !issues[idx].resolved;
  localStorage.setItem('issues', JSON.stringify(issues));
  renderIssues();
}
function deleteIssue(idx){
  if(localStorage.getItem('role') !== 'admin' && !requireAdmin()) return;
  if(!confirm('Delete this issue?')) return;
  issues.splice(idx,1);
  localStorage.setItem('issues', JSON.stringify(issues));
  renderIssues();
}

/* --- CGPA --- */
function addSubject(){ const d=document.createElement('div'); d.innerHTML = `<input type="number" placeholder="Credits" class="credit"><input type="number" placeholder="Grade (0-10)" class="grade">`; $('subjects').appendChild(d); }
function calculateCGPA(){
  const credits = [...document.querySelectorAll('.credit')].map(x=>+x.value||0);
  const grades = [...document.querySelectorAll('.grade')].map(x=>+x.value||0);
  const totalC = credits.reduce((a,b)=>a+b,0);
  const totalP = credits.map((c,i)=>c*grades[i]).reduce((a,b)=>a+b,0);
  $('cgpaResult').innerText = `Your CGPA is ${ totalC ? (totalP/totalC).toFixed(2) : 0 }`;
}

/* --- Admin-add items (require admin password if not admin) --- */
function addFaculty(){
  if(localStorage.getItem('role') !== 'admin' && !requireAdmin()) return;
  const name = prompt('Enter Faculty Name:'); if(!name) return;
  const dept = prompt('Enter Department:'); if(!dept) return;
  $('facultyList').innerHTML += `<div class="list-item"><b>${escapeHtml(name)}</b> - ${escapeHtml(dept)}</div>`;
  localStorage.setItem('facultyList', $('facultyList').innerHTML);
}
function addAlumni(){
  if(localStorage.getItem('role') !== 'admin' && !requireAdmin()) return;
  const name = prompt('Enter Alumni Name:'); if(!name) return;
  const year = prompt('Enter Graduation Year:'); if(!year) return;
  $('alumniList').innerHTML += `<div class="list-item"><b>${escapeHtml(name)}</b> - Class of ${escapeHtml(year)}</div>`;
  localStorage.setItem('alumniList', $('alumniList').innerHTML);
}
function addTournament(){
  if(localStorage.getItem('role') !== 'admin' && !requireAdmin()) return;
  const name = prompt('Enter Tournament Name:'); if(!name) return;
  const date = prompt('Enter Tournament Date:'); if(!date) return;
  $('tournamentList').innerHTML += `<div class="list-item"><b>${escapeHtml(name)}</b> - ${escapeHtml(date)}</div>`;
  localStorage.setItem('tournamentList', $('tournamentList').innerHTML);
}

/* small helper to avoid accidental HTML injection when saving prompts */
function escapeHtml(s){ return String(s).replaceAll('&','&amp;').replaceAll('<','&lt;').replaceAll('>','&gt;').replaceAll('"','&quot;'); }
</script>
</body>
</html>
